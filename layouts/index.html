{{ define "main" }}

{{ $chotu := resources.Get "chotu.png" }}
{{ $chotuSmile := resources.Get "chotu_smile.png" }}
<img
  src="{{ $chotu.RelPermalink }}"
  data-smile="{{ $chotuSmile.RelPermalink }}"
  data-normal="{{ $chotu.RelPermalink }}"
  alt="@chotu"
  class="chotu-img"
  id="chotuImg"
/>

<p style="font-size: 1.25rem; font-weight: bold;">Notes from a perpetual student</p>

<h1>Latest posts</h1>
<div class="posts-list">
{{ with .Site.GetPage "/posts" }}
    {{ range first 3 (sort .Data.Pages "Date" "desc" (where .Pages ".Params.private" "!=" true))}}
        <div class="post">
            <p>
                <div class="date">{{ .Date | time.Format ":date_medium" }}</div>
                <h1><a href="{{ .Permalink }}" title="{{ .Title }}">{{ .Title }}</a></h1>
                {{ .Summary }}
            </p>
        </div>    
    {{ end }}
{{ end }}
</div>

<h1>Latest photos</h1>

<div class="image-grid">
{{ with .Site.GetPage "/photos" }}
    {{ range first 3 (sort .Data.Pages "Date" "desc")}}
        <a href="{{ .Permalink }}" title="{{ .Title }}">
        {{ $image := .Page.Resources.GetMatch .Params.image }}
        {{ with $image }}
            {{ $thumb := .Fill "480x300 center" }}
            <img src="{{ $thumb.RelPermalink }}" alt="{{ .Title }}" class="img-responsive">
        {{end}}
        </a>
    {{ end }}
{{ end }}
</div>

<style>
  .chotu-img {
    display: block;
    height: 200px;
    width: auto;
    filter: brightness(0) invert(0);
    transition: filter 0.3s;
  }
  body.dark .chotu-img,
  html[data-theme='dark'] .chotu-img {
    filter: brightness(0) invert(1);
  }
  body.light .chotu-img,
  html[data-theme='light'] .chotu-img {
    filter: brightness(0) invert(0);
  }
  @media (prefers-color-scheme: dark) {
    .chotu-img {
      filter: brightness(0) invert(1);
    }
  }
  @media (prefers-color-scheme: light) {
    .chotu-img {
      filter: brightness(0) invert(0);
    }
  }
</style>
<script>
  const chotuImg = document.getElementById('chotuImg');
  if (chotuImg) {
    // Mouse hover
    chotuImg.addEventListener('mouseenter', function() {
      chotuImg.src = chotuImg.dataset.smile;
    });
    chotuImg.addEventListener('mouseleave', function() {
      chotuImg.src = chotuImg.dataset.normal;
    });
    // Touch/tap
    chotuImg.addEventListener('touchstart', function() {
      chotuImg.src = chotuImg.dataset.smile;
    });
    chotuImg.addEventListener('touchend', function() {
      chotuImg.src = chotuImg.dataset.normal;
    });
  }
</script>
{{ end }}